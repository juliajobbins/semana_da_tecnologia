<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird</title>
  <style>
    :root{
      --bg:#f8d


7e8;
      --ground:#f4a6c6;
      --pipe:#e38eb5;
      --ui:#ffffffcc;
      --accent:#ff6bcb;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:var(--bg);}
    body{display:flex;align-items:center;justify-content:center}
    .wrap{width:100vw;height:100vh;background:linear-gradient(#fbd6ec, #f6a5c0);position:relative;overflow:hidden}
    canvas{display:block;width:100%;height:100%}
    .ui{position:absolute;left:12px;top:12px;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,.3);font-weight:600}
    .score{position:absolute;right:12px;top:12px;background:var(--ui);color:#111;padding:6px 10px;border-radius:999px;font-weight:700}
    .overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none}
    .panel{pointer-events:auto;background:rgba(255,255,255,0.98);padding:22px;border-radius:10px;box-shadow:0 8px 24px rgba(0,0,0,.18);text-align:center;max-width:86%;}
    button{margin-top:12px;padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer}
    .small{font-size:14px;color:#333;margin-top:6px}
    .footer{position:absolute;left:12px;bottom:12px;color:#fff;opacity:.9}
    @media (max-width:420px){.wrap{border-radius:0}}
  </style>
</head>
<body>
  <div class="wrap">
    <canvas id="game"></canvas>
    <div class="ui">Flappy Bird</div>
    <div class="score" id="score">0</div>

    <div class="overlay" id="overlay">
      <div class="panel" id="panel">
        <h2 style="margin:0 0 8px">Flappy Bird</h2>
        <div class="small" id="panelText">Toque / clique / Espaço para pular. Evite os canos — veja quantos pontos você faz!</div>
        <button id="startBtn">Começar</button>
        <div class="small" style="margin-top:10px">O jogo salva seu melhor score localmente.</div>
      </div>
    </div>

    <div class="footer">Controles: Espaço / Clique / Toque</div>
  </div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
let W, H, DPR;

function resize(){
  DPR = window.devicePixelRatio || 1;
  const rect = canvas.getBoundingClientRect();
  canvas.width = Math.round(rect.width * DPR);
  canvas.height = Math.round(rect.height * DPR);
  W = canvas.width; H = canvas.height;
}
window.addEventListener('resize', ()=>{ resize(); draw() });
resize();

let running = false;
let gameOverState = false;
let pipes = [];
let frame = 0;
let score = 0;
let best = Number(localStorage.getItem('flappy_bird_best') || 0);
const gravity = 0.45 * DPR;

const bird = {
  x: Math.round(W * 0.22),
  y: Math.round(H * 0.45),
  vy: 0,
  radius: Math.round(12 * DPR),
  rotation: 0,
  w: Math.round(22 * DPR),
  h: Math.round(16 * DPR),
}

const pipeGap = Math.round(150 * DPR);
const pipeWidth = Math.round(56 * DPR);
const pipeSpeed = Math.round(2.4 * DPR);
const pipeSpawnInterval = 180; // colunas com distância equilibrada (~2s)
const groundHeight = Math.round(60 * DPR);

// Música de fundo
const bgMusic = new Audio('jellyous.mp3');
bgMusic.loop = true;
bgMusic.volume = 0.4;

// Tocar música após o primeiro clique
function playMusic() {
  bgMusic.play().catch(()=>{ console.log('Clique no jogo para iniciar a música'); });
}
document.addEventListener('click', playMusic, { once: true });

// Efeito sonoro
const AudioCtx = typeof AudioContext !== 'undefined' ? new AudioContext() : null;
function beep(freq=440, time=0.06){
  if(!AudioCtx) return;
  const o = AudioCtx.createOscillator();
  const g = AudioCtx.createGain();
  o.type = 'sine'; o.frequency.value = freq;
  g.gain.value = 0.02;
  o.connect(g); g.connect(AudioCtx.destination);
  o.start(); o.stop(AudioCtx.currentTime + time);
}

// Geração de canos
function spawnPipe(){
  const minPipeHeight = 80 * DPR;
  const maxPipeHeight = H - groundHeight - pipeGap - 80 * DPR;
  const topH = Math.round(minPipeHeight + Math.random() * (maxPipeHeight - minPipeHeight));
  const bottomY = topH + pipeGap;
  pipes.push({x: W + pipeWidth, top: topH, bottom: bottomY, passed: false});
}

function reset(){
  pipes = [];
  frame = 0;
  score = 0;
  bird.y = Math.round(H * 0.45);
  bird.vy = 0;
  running = false;
  gameOverState = false;
  document.getElementById('score').textContent = '0';
  showOverlay(true, 'Flappy Bird', 'Toque / clique / Espaço para pular. Evite os canos — veja quantos pontos você faz!');
}

function start(){
  if(AudioCtx && AudioCtx.state === 'suspended') AudioCtx.resume();
  if(gameOverState) return;
  running = true;
  document.getElementById('overlay').style.display = 'none';
}

function gameOver(){
  running = false;
  gameOverState = true;
  beep(120, 0.18);
  if(score > best){ best = score; localStorage.setItem('flappy_bird_best', best); }
  showOverlay(true, 'Game Over', `Score: ${score} • Melhor: ${best}`);
}

function showOverlay(show=true, title='Flappy Bird', text=''){
  const overlay = document.getElementById('overlay');
  const panel = document.getElementById('panel');
  overlay.style.display = show ? 'flex' : 'none';
  panel.querySelector('h2').textContent = title;
  document.getElementById('panelText').textContent = text;
}

function flap(){
  if(!running || gameOverState) return;
  bird.vy = -9 * DPR;
  beep(880, 0.04);
}

window.addEventListener('keydown', e=>{ if(e.code === 'Space'){ e.preventDefault(); if(!running && !gameOverState) start(); flap(); } });
canvas.addEventListener('mousedown', e=>{ if(!running && !gameOverState) start(); flap(); });
canvas.addEventListener('touchstart', e=>{ e.preventDefault(); if(!running && !gameOverState) start(); flap(); }, {passive:false});

function rectsOverlap(ax,ay,aw,ah,bx,by,bw,bh){
  return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
}

function update(){
  if(!running) return;
  frame++;
  bird.vy += gravity;
  bird.y += bird.vy;
  bird.rotation = Math.max(-0.6, Math.min(1.2, bird.vy * 0.03));
  if(frame % pipeSpawnInterval === 0) spawnPipe();
  for(let i = pipes.length-1; i>=0; i--){
    pipes[i].x -= pipeSpeed;
    if(!pipes[i].passed && pipes[i].x + pipeWidth < bird.x){ 
      pipes[i].passed = true; 
      score++; 
      document.getElementById('score').textContent = score; 
      beep(700 + (score*30), 0.02); 
    }
    if(pipes[i].x + pipeWidth < -50) pipes.splice(i,1);
  }
  if(bird.y + bird.h/2 > H - groundHeight){ gameOver(); }
  if(bird.y - bird.h/2 < 0){ bird.y = bird.h/2; bird.vy = 0; }
  for(const p of pipes){
    const bx1 = bird.x - bird.w/2, by1 = bird.y - bird.h/2, bw1 = bird.w, bh1 = bird.h;
    if(rectsOverlap(bx1,by1,bw1,bh1, p.x,0,pipeWidth,p.top) || rectsOverlap(bx1,by1,bw1,bh1, p.x,p.bottom,pipeWidth,H - groundHeight - p.bottom)){
      gameOver();
    }
  }
}

function draw(){
  ctx.clearRect(0,0,W,H);
  const g = ctx.createLinearGradient(0,0,0,H);
  g.addColorStop(0,'#ffd6eb'); g.addColorStop(1,'#f6a5c0');
  ctx.fillStyle = g; ctx.fillRect(0,0,W,H);

  // nuvens
  ctx.save();
  ctx.globalAlpha = 0.95;
  for(let i=0;i<3;i++){
    const cx = ((frame*0.25) + i*280*DPR) % (W + 300*DPR) - 150*DPR;
    drawCloud(cx, 80*DPR + i*50*DPR, 1.0 + i*0.2);
  }
  ctx.restore();

  // canos
  for(const p of pipes){
    ctx.fillStyle = '#e38eb5';
    ctx.fillRect(p.x, 0, pipeWidth, p.top);
    ctx.fillRect(p.x, p.bottom, pipeWidth, H - groundHeight - p.bottom);
    ctx.fillStyle = '#d16fa7';
    ctx.fillRect(p.x, p.top - 8*DPR, pipeWidth, 8*DPR);
    ctx.fillRect(p.x, p.bottom, pipeWidth, 8*DPR);
  }

  // chão
  const grd = ctx.createLinearGradient(0, H - groundHeight, 0, H);
  grd.addColorStop(0, '#e88fb8');
  grd.addColorStop(1, '#d76ea3');
  ctx.fillStyle = grd;
  ctx.fillRect(0, H - groundHeight, W, groundHeight);

  // pássaro
  ctx.save();
  ctx.translate(bird.x, bird.y);
  ctx.rotate(bird.rotation);
  drawBird(-bird.w/2, -bird.h/2, bird.w, bird.h);
  ctx.restore();
}

function drawCloud(x, y, scale = 1) {
  ctx.beginPath();
  const r = 15 * DPR * scale;
  ctx.arc(x, y, r, 0, Math.PI * 2);
  ctx.arc(x + r * 0.8, y - r * 0.3, r * 0.9, 0, Math.PI * 2);
  ctx.arc(x + r * 1.6, y, r * 1.1, 0, Math.PI * 2);
  ctx.arc(x + r * 0.8, y + r * 0.4, r, 0, Math.PI * 2);
  ctx.closePath();
  ctx.fillStyle = 'rgba(255, 255, 255, 0.98)';
  ctx.shadowColor = 'rgba(255, 255, 255, 0.6)';
  ctx.shadowBlur = 8 * DPR;
  ctx.fill();
  ctx.shadowBlur = 0;
}

function drawBird(x, y, w, h) {
  w *= 1.2;
  h *= 1.2;
  const grad = ctx.createRadialGradient(x + w * 0.5, y + h * 0.5, 2, x + w * 0.5, y + h * 0.5, w);
  grad.addColorStop(0, '#ffb3de');
  grad.addColorStop(1, '#ff5fb2');
  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.ellipse(x + w / 2, y + h / 2, w / 2, h / 2, 0, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#ff89c6';
  ctx.beginPath();
  ctx.ellipse(x + w * 0.45, y + h * 0.55, w * 0.25, h * 0.2, 0, 0, Math.PI * 2);
  ctx.fill();

  ctx.fillStyle = '#ffd15a';
  ctx.beginPath();
  ctx.moveTo(x + w * 0.88, y + h * 0.48);
  ctx.lineTo(x + w * 1.05, y + h * 0.5);
  ctx.lineTo(x + w * 0.88, y + h * 0.52);
  ctx.closePath();
  ctx.fill();

  ctx.beginPath();
  ctx.arc(x + w * 0.7, y + h * 0.38, 3 * DPR, 0, Math.PI * 2);
  ctx.fillStyle = '#222';
  ctx.fill();

  ctx.beginPath();
  ctx.arc(x + w * 0.72, y + h * 0.36, 1.2 * DPR, 0, Math.PI * 2);
  ctx.fillStyle = '#fff';
  ctx.fill();

  ctx.strokeStyle = 'rgba(0,0,0,0.15)';
  ctx.lineWidth = 1 * DPR;
  ctx.stroke();
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();

document.getElementById('startBtn').addEventListener('click', ()=>{ reset(); start(); });

setInterval(()=>{ bird.x = Math.round(W * 0.22); }, 800);
reset();
</script>
</body>
</html>
